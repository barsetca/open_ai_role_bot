# OpenAI Role Bot

Telegram-бот на Python (aiogram 3 + OpenAI API) с памятью диалога, переключаемыми режимами, учётом стоимости и генерацией изображений.

## Возможности

- **Диалог с контекстом** — хранение последних 10 пар сообщений для каждого чата
- **Режимы ассистента** — обычный помощник, разработчик, писатель, учитель, аналитик (редактируемые в `prompts.json`)
- **Статистика** — накопительный учёт токенов и примерная стоимость ($0.25 / 1M входящих, $2.00 / 1M исходящих)
- **Генерация изображений** — по текстовому описанию (модель настраивается в `.env`)

## Установка

```bash
python3 -m venv venv
source venv/bin/activate   # Windows: venv\Scripts\activate
pip install -r requirements.txt
cp .env.example .env
# Отредактируй .env: BOT_TOKEN, OPENAI_API_KEY и при необходимости модели
```

## Запуск

```bash
python main.py
```

## Команды и кнопки

| Кнопка / команда | Действие |
|------------------|----------|
| **Перезапуск** / `/start` | Приветствие и текущий режим |
| **Режим** / `/mode` | Список режимов и выбор по inline-кнопкам |
| **Очистить историю** / `/reset` | Очистка диалога (статистика не сбрасывается) |
| **Статистика** / `/stats` | Токены и примерная стоимость |
| **Обнулить статистику** / `/reset_stats` | Сброс накопительной статистики |
| **Картинка** | Включить режим: следующее сообщение — описание изображения |
| **/image** `<описание>` | Сгенерировать изображение одной командой |

## Генерация изображений

1. **Через кнопку:** нажми «Картинка» → введи описание в следующем сообщении (например, «закат над морем»).
2. **Через команду:** `/image закат над морем`

Модель задаётся в `.env` (`OPENAI_IMAGE_MODEL`, по умолчанию `gpt-image-1-mini`). Поддерживаются также `dall-e-3`, `dall-e-2`.

## Файлы

| Файл | Назначение |
|------|------------|
| `main.py` | Точка входа, обработчики, OpenAI (чат и изображения) |
| `config.py` | Настройки из `.env` |
| `memory.py` | Память диалога, статистика токенов, загрузка промптов |
| `prompts.json` | Режимы (системные промпты); можно добавлять и править |
| `.env` | Секреты (не коммитить); образец — `.env.example` |

Данные хранятся в `memory.json` (создаётся автоматически).

## Переменные окружения (.env)

| Переменная | Описание |
|------------|----------|
| `BOT_TOKEN` | Токен Telegram-бота (@BotFather) |
| `OPENAI_API_KEY` | Ключ API OpenAI |
| `OPENAI_MODEL` | Модель для диалога (по умолчанию `gpt-4o-mini`) |
| `OPENAI_IMAGE_MODEL` | Модель для изображений (по умолчанию `gpt-image-1-mini`) |

## Требования

Python 3.10+
